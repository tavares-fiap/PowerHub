CREATE DATABASE IF NOT EXISTS POWERHUB;
USE POWERHUB;

-- Tabela USER
CREATE TABLE USER (
    cpf CHAR(11) PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    phone_number VARCHAR(15),
    email VARCHAR(100) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL
);

-- Tabela RESIDENCE
CREATE TABLE RESIDENCE (
    id INT AUTO_INCREMENT PRIMARY KEY,
    cep CHAR(8) NOT NULL,
    country VARCHAR(50) NOT NULL,
    state CHAR(2) NOT NULL,
    city VARCHAR(100) NOT NULL,
    neighborhood VARCHAR(100) NOT NULL,
    street VARCHAR(150) NOT NULL,
    number VARCHAR(10) NOT NULL,
    additional VARCHAR(100),
    energy_fee FLOAT NOT NULL,
    user_cpf CHAR(11) NOT NULL,
    FOREIGN KEY (user_cpf) REFERENCES USER(cpf) ON DELETE CASCADE
);

-- Tabela DEVICE
CREATE TABLE DEVICE (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    power FLOAT NOT NULL,
    status BOOLEAN DEFAULT 0,
    residence_id INT NOT NULL,
    FOREIGN KEY (residence_id) REFERENCES RESIDENCE(id) ON DELETE CASCADE
);

-- Tabela MEASUREMENT
CREATE TABLE MEASUREMENT (
    id INT AUTO_INCREMENT PRIMARY KEY,
    device_id INT NOT NULL,
    started DATETIME NOT NULL,
    ended DATETIME,
    consumption FLOAT NOT NULL,
    FOREIGN KEY (device_id) REFERENCES DEVICE(id) ON DELETE CASCADE
);
